# YOLOv5 를 이용한 객체인식  
> 개발 환경
- 운영체제: Window10
- 가상환경: WSL2, Docker
- 컨테이너 내 운영체제: Ubuntu:20.04
> PC정보  

|하드웨어명|정보|
|---|:---|
|CPU|Intel(R) Core(TM) i7-8086K @ 4.00GHz(12CPUs)|
|GPU|NVIDIA Geforce RTX 2080 (16GB)|
|RAM|32GB|  

> 사용한 패키지

|패키지명|버전|
|---|:---|
|Python|3.9.6|
|Jupyter_client|7.4.7|
|CUDA|11.6|
|Pytorch|1.13|
|Pandas|1.5.2|
|Yolo|v5|
|OpenCV|4.6.0.66|
|Pillow|9.0.1|  

---  
> 데이터 정제  
- json파일에서 annotation 과 img_path 의 정보들을 추출
- 이미지 파일명과 레이블의 파일명을 anno_id로 통일화
- 레이블의 x,y,w,h 값들을 이미지 크기의 비율에서 정규화

> 모델 설명  
- 사용한 Yolo모델 : yolov5x
- Pre-trained 모델 : yolov5x
- 배치사이즈: 4
- 이미지 크기: 640
- 데이터 갯수: 4000
- epoch: 100
- Optimizer: SGD
- learning_rate: 0.01


> 학습결과  
- Confusion Matrix (혼돈 행렬)  
![confusion_matrix](https://github.com/Oldentomato/datathon/blob/main/readme_img/confusion_matrix.png)  
**레이블이 한글이라 이름이 깨짐**  
- 전체적인 결과
![results](https://github.com/Oldentomato/datathon/blob/main/readme_img/results.png)  
- 정답이미지와 레이블
![labels](https://github.com/Oldentomato/datathon/blob/main/readme_img/val_batch0_labels.jpg)
- 예측이미지와 레이블
![pred](https://github.com/Oldentomato/datathon/blob/main/readme_img/val_batch0_pred.jpg)  
- 클래스별 예측결과 리스트  

|클래스명|이미지수|Instances|Precision|Recall|mAP50|mAP50-95| 
|---|---|---|---|---|---|---|  
집전체 |   4000    |   1001   |   0.999    |  0.987  |    0.995  |    0.975  
지붕    |   4000    |   1011   |   0.998   |   0.996  |    0.995   |   0.969
집벽    |   4000    |   1013   |   0.999   |   0.988  |    0.995  |    0.975
문     |  4000    |   1018   |   0.993  |    0.996  |    0.995  |    0.943
창문    |   4000   |    1780  |    0.994  |    0.998   |   0.995  |    0.915
굴뚝    |   4000    |   1011   |   0.999  |    0.993  |    0.995  |    0.952
연기    |   4000    |   1011   |   0.997     | 0.998   |   0.995  |    0.922
울타리   |    4000    |   1473   |   0.997    |  0.972   |   0.994  |    0.938
길    |   4000   |    1057   |   0.993    |  0.973   |   0.994   |    0.95
연못   |    4000    |   1007    |      1     |     1  |    0.995  |    0.978
산     |  4000   |    1201  |    0.997    |  0.972   |   0.995   |   0.947
나무    |   4000    |   1266  |    0.997   |   0.999   |   0.995  |    0.968
꽃    |   4000   |    4381   |   0.992   |   0.998    |  0.995   |   0.918
잔디    |   4000     |  4210   |   0.991   |   0.973  |    0.993  |    0.823
태양    |   4000    |   1000    |  0.999    |      1   |   0.995  |    0.969
나무전체   |    4000  |     1000   |   0.998    |   0.95   |   0.992  |    0.954
기둥    |   4000    |   1001   |   0.993   |   0.981   |   0.995   |   0.881
수관    |   4000    |   1088   |   0.999    |  0.885   |   0.989   |   0.956
가지     |  4000    |   1622    |  0.987   |   0.953   |  0.991    |  0.873
뿌리     |  4000    |   1008     |     1     | 0.998    |  0.995    |  0.922
나뭇잎    |   4000    |   3227   |   0.986   |   0.992    |  0.995   |    0.84
열매     |  4000    |   3749   |   0.989    |  0.991   |   0.995   |    0.85
그네    |   4000  |     1021   |   0.997    |      1   |   0.995  |    0.964
새    |   4000      | 1096    |  0.996    |  0.999   |   0.995    |  0.943
다람쥐   |   4000    |   1019    |  0.994    |      1   |   0.995   |    0.94
구름    |   4000   |    1889   |   0.997   |   0.998   |   0.995   |   0.957
달     |  4000   |    1006    |  0.994    |  0.999   |   0.995   |   0.941
별     |  4000    |   3378    |  0.993   |   0.989  |    0.994   |   0.859
사람전체     |  4000    |   2000    |  0.993   |   0.959    | 0.984    |  0.964
머리   |    4000    |   2000     |     1    |  0.957    |  0.995   |   0.958
얼굴   |    4000   |    2001   |   0.997  |     0.95   |   0.991   |   0.922
눈     |  4000    |   3999    |  0.985    |  0.971   |   0.985  |    0.779
코    |   4000    |   2001   |   0.982    |  0.885   |   0.941   |   0.652
입    |   4000    |   2000    |  0.986    |  0.954   |   0.983   |   0.805
귀    |   4000    |  3978   |   0.999    |  0.998    |  0.995    |  0.801
머리카락    |   4000    |   2001   |   0.998     | 0.866   |   0.983    |  0.883
목    |   4000     |  2000   |   0.991    |  0.995    |  0.995    |  0.756
상체   |    4000  |     2001  |    0.994   |   0.969  |    0.993  |   0.936
팔    |   4000    |   4000    |  0.999   |   0.998     | 0.995   |  0.935
손    |   4000    |   3988    |  0.992   |   0.994   |   0.995    |  0.866
다리   |    4000   |    3996   |   0.995   |   0.996   |   0.995   |   0.944
발    |   4000     |  3999    |  0.991   |   0.995   |   0.995    |  0.872
단추    |   4000   |    2105    |  0.986   |   0.929    |  0.971     | 0.777
주머니   |    4000    |   3706   |   0.987   |   0.986   |   0.993  |    0.786
운동화     |  4000   |    4004    |  0.995    |  0.999   |   0.995    |  0.925
여자구두    |   4000   |    2002   |   0.992   |   0.995   |   0.995  |    0.935
남자구두    |   4000   |    1999    |  0.983   |   0.998   |   0.995    |  0.921
> 사용법  
- 검증명령어
    ```
    python detect.py --weights runs/train/yolov5x_result/weights/best.pt --img 640 --conf 0.4 --source ./inference/images/ 
    ```
    - --weights: 저장된 가중치 가져오는 경로
    - --img: 이미지 크기 640으로 조정 (검증시에만)
    - --conf: 0.4이상으로 검출된 레이블만 출력
    - --source: 테스트할 이미지들 경로

